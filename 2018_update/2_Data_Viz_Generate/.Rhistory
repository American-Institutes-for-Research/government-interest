setwd("F:\\Govt_Int\\2018_Update\\2018_Update_gov_int")
script_v <- "4.0"
library(trend)
library(plyr)
library(scales)
library(MASS)
library(reshape)
library(tools)
library(plotly)
library(rjson)
library(data.table)
library(gridExtra)
library(psych)
library(trend)
library(dbplyr)
library(dplyr)
library(extrafont)
loadfonts(device = "win")
library (ggplot2)
# set color scheme
cyan <- rgb (0, 123, 188,	maxColorValue = 255)
darkRed <- rgb (208, 32, 47, maxColorValue = 255)
darkBlue <- rgb (0, 66, 118	, maxColorValue=255)
darkGreen <- rgb (91, 140, 41, maxColorValue=255)
darkPurple <- rgb (135, 30, 110, maxColorValue=255)
darkGrey <- rgb (51, 54, 58, maxColorValue=255)
lightGrey <- rgb (152, 152, 152, maxColorValue=255)
setwd("F:/Govt_Int/2018_Update/2018_Update_gov_int")
script_v <- "3.0"
source("G:\\config.r")
my_db=src_mysql(dbname=dbname_new,host=host,port=port,user=user,password=password)
in.patent_level <- as.data.frame(tbl(my_db, "temp_patent_level_gi"))
in.gov_level <- as.data.frame(tbl(my_db, "temp_gi_level_gi"))
in.patent_level <- as.data.frame(tbl(my_db, "temp_patent_level_gi_v3"))
in.gov_level <- as.data.frame(tbl(my_db, "temp_gi_level_gi_v3"))
in.sector <- read.csv("data_to_read\\assignees_lookedup_types.csv", header = TRUE, stringsAsFactors = FALSE)
in.patent_level <- in.patent_level %>% filter(year != "NULL" & year >= 1980 & year <= 2017) # filter on years
patents.keep_ids <- in.patent_level$patent_id
# filter on gov_level ids to get the right data
in.gov_level <- in.gov_level %>% filter(patent_id %in% patents.keep_ids)
# merge data two main data files
in.patent_level.merged <- merge(in.patent_level, in.gov_level, by="patent_id")
in.sector$organization <- trimws(in.sector$organization)
sector_org.merged <- in.patent_level.merged %>%
select(patent_id, level_one) %>%
distinct() %>% # just patent_id, level_one org
inner_join(in.sector, by="patent_id") %>%
select(patent_id, level_one, type, organization, thes_types)
sector_org.merged.ratio <- sector_org.merged %>%
group_by(patent_id) %>%
mutate(weight = 1/n())
# change the thes_types
sector_org.merged.ratio.clnd <- sector_org.merged.ratio %>%
mutate(thes_types = recode(thes_types, 'Ambiguous' = 'Corporate',
'Hospital' = "Academic or Hospital",
'Academic' = "Academic or Hospital",
'Person' = "Other"))
# add a column weight = 1 / number of patent_id
sector_org.merged.ratio.clnd <- sector_org.merged.ratio.clnd %>%
group_by(patent_id) %>%
mutate(weight = 1/n())
in.cite_1 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr1_v3"))
in.cite_2 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr2_v3"))
in.cite_3 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr3_v3"))
in.cite_4 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr4_v3"))
in.cite_5 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr5_v3"))
in.cite_1_sum <- in.cite_1 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_2_sum <- in.cite_2 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_3_sum <- in.cite_3 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_4_sum <- in.cite_4 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_5_sum <- in.cite_5 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
cit.merge_1 <- in.patent_level %>%
filter(year < 2013) %>%
left_join(in.cite_1_sum, by = c("patent_id" = "patent_id"))
cit.merge_2 <- left_join(cit.merge_1, in.cite_2_sum, by = c("patent_id" = "patent_id"), suffix = c("_yr1", "_yr2"))
cit.merge_3 <- cit.merge_2 %>% left_join(in.cite_3_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr2", "_yr3"))
cit.merge_4 <- cit.merge_3 %>% left_join(in.cite_4_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr3", "_yr4"))
cit.merge_5 <- cit.merge_4 %>% left_join(in.cite_5_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr4", "_yr5"))
sector_merge <- cit.merge_5 %>% left_join(sector_org.merged.ratio.clnd, by="patent_id")
sector_merge$First <- sector_merge$num_citation_yr1 * sector_merge$weight
sector_merge$Second <- sector_merge$num_citation_yr2 * sector_merge$weight
sector_merge$Third <- sector_merge$num_citation_yr3 * sector_merge$weight
sector_merge$Fourth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge$Fifth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge.sub <- sector_merge[,c(23:28)]
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth)#, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
sector_merge$First <- sector_merge$num_citation_yr1 * sector_merge$weight
sector_merge$Second <- sector_merge$num_citation_yr2 * sector_merge$weight
sector_merge$Third <- sector_merge$num_citation_yr3 * sector_merge$weight
sector_merge$Fourth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge$Fifth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge.sub <- sector_merge[,c(23:28)]
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
colnames(sector_merge)
sector_merge$First <- sector_merge$num_citation_yr1 * sector_merge$weight
sector_merge$Second <- sector_merge$num_citation_yr2 * sector_merge$weight
sector_merge$Third <- sector_merge$num_citation_yr3 * sector_merge$weight
sector_merge$Fourth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge$Fifth <- sector_merge$num_citation * sector_merge$weight
sector_merge.sub <- sector_merge[,c(23:30)]
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
cit_sector.count.clnd$First <- cit_sector.count.clnd$First / cit_sector.count.clnd$weight
cit_sector.count.clnd$Second <- cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.clnd
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:6))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
cit_sector.count.clnd$First <- cit_sector.count.clnd$First / cit_sector.count.clnd$weight
cit_sector.count.clnd$Second <- cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:7))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
sector_merge.sub <- sector_merge[,c(23:30)]
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
cit_sector.count.clnd$First <- cit_sector.count.clnd$First / cit_sector.count.clnd$weight
cit_sector.count.clnd$Second <- cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:7))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
library(trend)
library(plyr)
library(scales)
library(MASS)
library(reshape)
library(tools)
library(plotly)
library(rjson)
library(data.table)
library(gridExtra)
library(psych)
library(trend)
library(dbplyr)
library(dplyr)
library(extrafont)
loadfonts(device = "win")
library (ggplot2)
# set color scheme
cyan <- rgb (0, 123, 188,	maxColorValue = 255)
darkRed <- rgb (208, 32, 47, maxColorValue = 255)
darkBlue <- rgb (0, 66, 118	, maxColorValue=255)
darkGreen <- rgb (91, 140, 41, maxColorValue=255)
darkPurple <- rgb (135, 30, 110, maxColorValue=255)
darkGrey <- rgb (51, 54, 58, maxColorValue=255)
lightGrey <- rgb (152, 152, 152, maxColorValue=255)
setwd("F:/Govt_Int/2018_Update/2018_Update_gov_int")
script_v <- "3.0"
windowsFonts(Times=windowsFont("TT Times New Roman"))
# check for supporting docs and code in github or on the patentsview shared drive
windowsFonts(Times=windowsFont("TT Times New Roman"))
extrafont::loadfonts(device="win")
library(trend)
library(plyr)
library(scales)
library(MASS)
library(reshape)
library(tools)
library(plotly)
library(rjson)
library(data.table)
library(gridExtra)
library(psych)
library(trend)
library(dbplyr)
library(dplyr)
library(extrafont)
loadfonts(device = "win")
library (ggplot2)
source("G:\\config.r")
my_db=src_mysql(dbname=dbname_new,host=host,port=port,user=user,password=password)
in.patent_level <- as.data.frame(tbl(my_db, "temp_patent_level_gi"))
warnings(
)
# check for supporting docs and code in github or on the patentsview shared drive
windowsFonts(Times=windowsFont("TT Times New Roman"))
extrafont::loadfonts(device="win")
library(trend)
library(plyr)
library(scales)
library(MASS)
library(reshape)
library(tools)
library(plotly)
library(rjson)
library(data.table)
library(gridExtra)
library(psych)
library(trend)
library(dbplyr)
library(dplyr)
library(extrafont)
loadfonts(device = "win")
library (ggplot2)
cyan <- rgb (0, 123, 188,	maxColorValue = 255)
darkRed <- rgb (208, 32, 47, maxColorValue = 255)
darkBlue <- rgb (0, 66, 118	, maxColorValue=255)
darkGreen <- rgb (91, 140, 41, maxColorValue=255)
darkPurple <- rgb (135, 30, 110, maxColorValue=255)
darkGrey <- rgb (51, 54, 58, maxColorValue=255)
lightGrey <- rgb (152, 152, 152, maxColorValue=255)
setwd("F:/Govt_Int/2018_Update/2018_Update_gov_int")
script_v <- "3.0"
source("G:\\config.r")
my_db=src_mysql(dbname=dbname_new,host=host,port=port,user=user,password=password)
in.patent_level <- as.data.frame(tbl(my_db, "temp_patent_level_gi_v3"))
#read from db
in.patent_level <- as.data.frame(tbl(my_db, "temp_patent_level_gi_v3"))
in.gov_level <- as.data.frame(tbl(my_db, "temp_gi_level_gi_v3"))
in.sector <- read.csv("data_to_read\\assignees_lookedup_types.csv", header = TRUE, stringsAsFactors = FALSE)
in.patent_level <- in.patent_level %>% filter(year != "NULL" & year >= 1980 & year <= 2017) # filter on years
patents.keep_ids <- in.patent_level$patent_id
in.gov_level <- in.gov_level %>% filter(patent_id %in% patents.keep_ids)
in.patent_level.merged <- merge(in.patent_level, in.gov_level, by="patent_id")
test <- left_join(in.patent_level, in.gov_level, by = "patent_id")
warnings
warnings()
windowsFonts(Arial=windowsFont("TT Arial"))
test <- left_join(in.patent_level, in.gov_level, by = "patent_id")
in.sector$organization <- trimws(in.sector$organization)
sector_org.merged <- in.patent_level.merged %>%
select(patent_id, level_one) %>%
distinct() %>% # just patent_id, level_one org
inner_join(in.sector, by="patent_id") %>%
select(patent_id, level_one, type, organization, thes_types)
sector_org.merged.ratio <- sector_org.merged %>%
group_by(patent_id) %>%
mutate(weight = 1/n())
sector_org.merged.ratio <- sector_org.merged %>%
group_by(patent_id) %>%
mutate(weight = 1/n())
sector_org.merged.ratio.clnd <- sector_org.merged.ratio %>%
mutate(thes_types = recode(thes_types, 'Ambiguous' = 'Corporate',
'Hospital' = "Academic or Hospital",
'Academic' = "Academic or Hospital",
'Person' = "Other"))
View(sector_org.merged.ratio.clnd)
sector_org.merged.ratio.clnd <- sector_org.merged.ratio.clnd %>%
group_by(patent_id) %>%
mutate(weight = 1/n())
in.cite_1 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr1_v3"))
in.cite_2 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr2_v3"))
in.cite_3 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr3_v3"))
in.cite_4 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr4_v3"))
in.cite_5 <- as.data.frame(tbl(my_db, "temp_5yr_citations_by_cite_yr5_v3"))
in.cite_1_sum <- in.cite_1 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_2_sum <- in.cite_2 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_3_sum <- in.cite_3 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_4_sum <- in.cite_4 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
in.cite_5_sum <- in.cite_5 %>%
group_by(cited_patent_id) %>%
summarise(num_citation = sum(num_times_cited_by_us_patents)/n()) %>%
rename(patent_id = cited_patent_id, num_citation = num_citation)
cit.merge_1 <- in.patent_level %>%
filter(year < 2013) %>%
left_join(in.cite_1_sum, by = c("patent_id" = "patent_id"))
cit.merge_2 <- left_join(cit.merge_1, in.cite_2_sum, by = c("patent_id" = "patent_id"), suffix = c("_yr1", "_yr2"))
cit.merge_3 <- cit.merge_2 %>% left_join(in.cite_3_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr2", "_yr3"))
cit.merge_4 <- cit.merge_3 %>% left_join(in.cite_4_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr3", "_yr4"))
cit.merge_5 <- cit.merge_4 %>% left_join(in.cite_5_sum, by = c("patent_id" = "patent_id"),suffix = c("_yr4", "_yr5"))
sector_merge <- cit.merge_5 %>% left_join(sector_org.merged.ratio.clnd, by="patent_id")
sector_merge <- cit.merge_5 %>% left_join(sector_org.merged.ratio.clnd, by="patent_id")
View(sector_merge)
sector_merge$First <- sector_merge$num_citation_yr1 * sector_merge$weight
sector_merge$Second <- sector_merge$num_citation_yr2 * sector_merge$weight
sector_merge$Third <- sector_merge$num_citation_yr3 * sector_merge$weight
sector_merge$Fourth <- sector_merge$num_citation_yr4 * sector_merge$weight
sector_merge$Fifth <- sector_merge$num_citation * sector_merge$weight
sector_merge.sub <- sector_merge[,c(23:30)]
sector_merge.sub[is.na(sector_merge.sub)] <- 0
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
View(cit_sector.count.clnd)
cit_sector.count.clnd$First
cit_sector.count.clnd$weight
cit_sector.count.clnd$First / cit_sector.count.clnd$weight
68636.61/30508.826
cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:7))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
View(cit_sector.count.melt.clnd)
in.sector.archive %>% group_by(thes_types) %>% summarise(count = length(patent_id))
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
cit_sector.count.clnd$First <- cit_sector.count.clnd$First / cit_sector.count.clnd$weight
cit_sector.count.clnd$Second <- cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:7))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
cit_sector.count <- aggregate(cbind (weight, First, Second, Third, Fourth, Fifth)
~
thes_types, sum, na.rm= TRUE, data = sector_merge.sub)
cit_sector.count.clnd <- cit_sector.count %>% filter(thes_types != 0)
cit_sector.count.clnd$First <- cit_sector.count.clnd$First / cit_sector.count.clnd$weight
cit_sector.count.clnd$Second <- cit_sector.count.clnd$Second / cit_sector.count.clnd$weight
cit_sector.count.clnd$Third <- cit_sector.count.clnd$Third / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fourth <- cit_sector.count.clnd$Fourth / cit_sector.count.clnd$weight
cit_sector.count.clnd$Fifth <- cit_sector.count.clnd$Fifth / cit_sector.count.clnd$weight
cit_sector.count.melt <- melt(cit_sector.count.clnd, id="thes_types", measure.vars = c(3:7))
cit_sector.count.melt.clnd <- cit_sector.count.melt %>% filter(thes_types != "Other")
View(cit_sector.count.melt.clnd)
g.27 <- ggplot(cit_sector.count.melt.clnd, aes(x=variable,y=value,fill=thes_types)) +
geom_bar(stat="identity", position = "dodge") +
labs(y= "Average Accrued Weighted Citations", x="Year After Publication") +
scale_y_continuous(label=comma) +
scale_fill_manual(values=c(darkPurple, cyan, darkGreen), labels=c("Academic", "Corporate", "Government")) +
theme_set(theme_gray(base_size = 16)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
text=element_text(size=16,  family="Cambria"),
legend.title=element_blank()
)
g.27
source("helpers.R")
getwd()
setwd("G:/ PatentsView/government-interest/2018_update")
setwd("G:/ PatentsView/government-interest/2018_update")
setwd("G:/ PatentsView/government-interest/2018_update/2_Data_Viz_Generate")
setwd("G:/PatentsView/government-interest/2018_update/2_Data_Viz_Generate")
source("helpers.R")
loadfonts(device = "win")
pkg_list <- c("trend", "plyr", "scales", "MASS", "reshape", "tools", "plotly", "rjson",
"data.table", "gridExtra", "psych", "dplyr", "dbplyr", "extrafont", "ggplot2")
lapply(pkg_list, install_pkgs)
pkg_list <- c("trend", "plyr", "scales", "MASS", "reshape", "tools", "plotly", "rjson",
"data.table", "gridExtra", "psych", "dplyr", "dbplyr", "extrafont", "ggplot2")
lapply(pkg_list, install_pkgs)
source("helpers.R")
lapply(pkg_list, install_pkgs)
install_pkgs <- function(pkg) {
# Install package if it isn't already
if (!(pkg %in% installed.packages()[, "Package"])){
install.packages(pkg, repos='http://cran.us.r-project.org')
}
library(pkg, character.only = TRUE)
} # end install_pkgs()
loadfonts(device = "win")
pkg_list <- c("trend", "plyr", "scales", "MASS", "reshape", "tools", "plotly", "rjson",
"data.table", "gridExtra", "psych", "dplyr", "dbplyr", "extrafont", "ggplot2")
lapply(pkg_list, install_pkgs)
getwd()
source("helpers.R")
gewd()
getwd()
source("helpers.R")
install_pkgs <- function(pkg) {
# Install package if it isn't already
if (!(pkg %in% installed.packages()[, "Package"])){
install.packages(pkg, repos='http://cran.us.r-project.org')
}
library(pkg, character.only = TRUE)
} # end install_pkgs()
loadfonts(device = "win")
pkg_list <- c("trend", "plyr", "scales", "MASS", "reshape", "tools", "plotly", "rjson",
"data.table", "gridExtra", "psych", "dplyr", "dbplyr", "extrafont", "ggplot2")
lapply(pkg_list, install_pkgs)
figure2 <- function(){
# 5. patent classifications -- WIPO fields (below sectors)
freq.wipo_field <- as.data.frame(table(in.patent_level$wipo_field))
freq.wipo_field <- freq.wipo_field %>%
select(wipo_field = Var1, freq = Freq)
freq.wipo_field.nn <- freq.wipo_field %>%
filter(wipo_field != "NULL") %>%
arrange(desc(freq))
top5 <- as.character(freq.wipo_field.nn[1:6,1])
sum.weights <- sum(freq.wipo_field.nn$freq)
freq.wipo_field.nn <- freq.wipo_field.nn %>%
mutate(percentage = freq/sum.weights)
# longitudinal (gi_patents)
long.5a <- as.data.frame(table(in.patent_level$wipo_field, in.patent_level$year))
keep.5a <- long.5a %>%
select(wipo_field = Var1, year = Var2, freq = Freq) %>%
filter(wipo_field %in% top5)
long.5a <- long.5a %>% select(wipo_field = Var1, year = Var2, freq = Freq)
#change the year from discrete value to continuous value so that it could be plot by ggplot2
keep.5a$year <- as.numeric(levels(keep.5a$year))[keep.5a$year]
g.5l <- ggplot(keep.5a, aes(x = year, y = freq, colour=wipo_field, group = wipo_field, linetype=wipo_field)) +
geom_line(size=1.5) +
ylab(label="Number of Patents") +  xlab("Year") +
scale_colour_manual(values=c(cyan, darkGrey, darkGreen, darkRed, darkPurple, lightGrey)) +
scale_linetype_manual(values=c("solid", "twodash", "dashed", "dotted", "longdash", "dotdash")) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 10))+
#scale_x_continuous(breaks=c(1980,1985,1990,1995,2000,2005,2010,2015)) +
theme_set(theme_gray(base_size = 16)) +
guides(colour=guide_legend(nrow=3,byrow=TRUE)) +
theme(legend.direction = 'horizontal',
legend.position = 'bottom',
legend.key = element_blank(),
legend.key.width = unit(3, 'lines'),
legend.title=element_blank(),
text=element_text(size=16,  family="Cambria")
)
g.5l
ggsave (filename = paste0("data_viz\\longWipoFields_v", script_v, ".png"), plot = g.5l, device = "png")
}
